# Nonparametric-extrapolation-extreme-quantiles

This repository contains the code to compute non parametric extrapolation of extreme quantiles, from a huge number of synthetic datasets. In the code are implemented four nonparametric techniques for extrapolation: Hutson (2002), HTS, Kernel Density Estimation, KDE, and two versions of Scholz (2005), respectively called SC0 and SC7. The code also compares perfromances among the different methodologies. For any question or comment concerning the code please contact Fabiola Banfi (fabiola.banfi@polimi.it) or Greta Cazzaniga (greta.cazzaniga@polimi.it).

The code for generation of synthetic data and extrapolation of extreme quantiles is written in R. Packages required to run the code include `climod`, `kdensity`, `rstudioapi`, `rtop`, and `reshape2`.
The code, which plot figures is instead written in Python 3 and dependencies required are `pyreadr`, `numpy`, `pandas`, and `matplotlib`. Moreover an installation of jupyter is needed to run the *.ipynb notebook.

## Repository structure:
- `0_RunCode.R` file contains the script to run the whole analysis. This is the unique R code to be run. It generates syntehtic datasets and, for each dataset, it estimates quantiles for selected return periods and with the four nonparametric techniques, reported above. Results are summarized in 5 .rds files generated by the code:
  * `EstimatedQuantiles_and_Errors_*DistributionName*.rds` includes a dataframe with estimated extreme quantiles and the relative error between the estimates and the theoretical quantiles;
  * `QuartilesErrors_*DistributionName*.rds` reports 25th, 50th, and 75th percentiles of relative errors, for quantiles extrapolated from synthetic datasets with same sample length, return period, and method;
  * `InvalidData_*DistributionName*.rds` contains the number of simulations which have been avoided since they provide invalid results for SC0 and/or SC7 techniques;
  * `OptimumParameters_*DistributionName*.rds` contains parameters optimized, for nonparametric extrapolation of quantiles, for HTS, SC0, and SC7;
  * `SyntheticDataSet_*DistributionName*.rds` contains generated synthetic datasets.
- `1_main.R` script is called in `0_RunCode.R` and contains the main code. This script must not be run;
- `2_functions.R` script contains the list of functions required by `1_main.R`. This script must not be run;
- `input.txt` text file including all the setting options for generation of synthetic datasets and selection of return periods for which to calculate the quantiles in extrapolation. In this file, these options can be changed by users:
  * name of the distribution from which synthetic datasets are generated. Distributions available for the code are *Gamma*, *Cauchy*, and *Uniform*;
  * values of distribution parameters. Insert as par1 and par2 respectively the shape and scale parameters for *Gamma* disitrbution, the location and scale parameters for *Cauchy*, and lower and upper limits for *Uniform*;
  * number of synthetic datasets to be generated;
  * sample length/lengths of synthetic datasets (user can enter up to 6 sample lengths);
  * return period/periods for which to estimate the quantiles (user can enter up to 5 return periods);
- `CreateFigures.ipynb` notebook for plotting 4 figures which are saved as .pdf files. 

## References:
Hutson, A. D. (2002). A semi-parametric quantile function estimator for use it in bootstrap estimation procedures. *Statistics and Computing, 12(4)*, 331-338. doi: 10.1023/A:1020783911574

Scholz, F. W. (1995). Nonparametric tail extrapolation: Simulation Results (Tech. Rep. No. ISSTECH-95-015). Seattle, WA, United States of America: Boeing Information and Support Services.
